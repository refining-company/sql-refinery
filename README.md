# Todo

0. Priority

   - Fix testing of standalone server by emulating LSP events

   - `Workspace` should create and maintain one `code.Tree` and `logic` should compare one file against the rest.

   - `Workspace` should manage file parsing pipeline. For that it should have
     `pipeline = [sql.parse, code.parse, logic.parse]` and `load_codebase` should moves files through each stage.
     `pipeline(i)` should depend only on the `pipeline(i-1)`.

   - `Workspace` should contain entire state from all stages and make it available to functions of the pipeline
     (`sql.parse`, `code.parse`, `logic.parse`, others).

   - `Workspace` should introduce `ingest_file` that runs the file through the pipeline and updates the state.
     `load_codebase` shoule be renamed to `ingest` and use `ingest_file`.

1. Backlog

   - Caching. fter each file being injested `Workspace` should somehow cache it to the filesystem. That might require
     creating another data structure that lies in between `tree_sitter.Tree` and `code.Tree` and will replace meta-types
     in `sql` starting with `@` that effectively allow to reduce complexity of parse tree generated by `tree_sitter`.

   - Incremental parsing. `Workspace` should learn to do incrementall file parsing and propagate those changes through
     the entire pipeline of `sql.parse`, `code.parse`, `logic.parse`. Each time only impacted nodes should be
     recalculated (e.g. deleted nodes, added nodes, changed nodes).

   - Push to server. Once `Workspace` has got any insights (e.g. additional `logic.Alternative`), it should push it to
     the `Server`. Once `Server` received any inputs from the `VS Code` (e.g. changes to file or new file) it should
     push it to the `Workspace`. Ideally there should be 3 independent processes: `Server` that communicates with the
     `Client` and pulls pre-calculated information from `Workspace` or information that can be quickly evaluated,
     `Workspace` that constantly does analysis of files and pushes updates, `Client` that communicates with the
     `VS Code`.

2. Minor

   - `code` datastructures should have location (`uri` + `start_position` + `end_position`).

   - `code.Tree` should have different inner representation, maybe like mapping not like two independend lists.

   - update `test_pipeline.py:simplify()` to run through all fields of dataclasses and simplify them recursively.

   - `code` data structures should have `__hash__` potentially from making a `frozen` dataclass.

   - Implement proper logging with `logger` instead of `print`.
