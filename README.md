# Todo

1. Clean up architecture

   - `Session` should be reading in files from workspace and open files one-by-one, not in batches. It should run it
     through the entire pieline of `sql.parse`, `code.parse` and then `logic.parse` and create all sorts of maps and
     dictionaries used.

   - `Session` should store all information needed for further quick calculations (e.g. `code.Map` should be calculated
     at the `Session` level and reused by various other modules if needed).

   - After each file being injested `Session` should somehow cache it to the filesystem. That might require creating
     another data structure that lies in between `tree_sitter.Tree` and `code.Tree` and will replace meta-types in `sql`
     starting with `@` that effectively allow to reduce complexity of parse tree generated by `tree_sitter`.

   - Once `Session` has got any insights (e.g. additional `logic.Alternative`), it should push it to the `Server`. Once
     `Server` received any inputs from the `VS Code` (e.g. changes to file or new file) it should push it to the
     `Session`. Ideally there should be 3 independent processes: `Server` that communicates with the `Client` and pulls
     pre-calculated information from `Session` or information that can be quickly evaluated, `Session` that constantly
     does analysis of files and pushes updates, `Client` that communicates with the `VS Code`.

   - `Session` should learn to do incrementall file parsing and propagate those changes through the entire pipeline of
     `sql.parse`, `code.parse`, `logic.parse`. Each time only impacted nodes should be recalculated (e.g. deleted nodes,
     added nodes, changed nodes).

2. Clean up minor bits.

   - `logic` should be changed to `Inconsistencies`. `Session` should be changed to `Workspace`.

   - `code` datastructures should have location (`uri` + `start_position` + `end_position`).

   - `code.Tree` should have different inner representation, maybe like mapping not like two independend lists.

   - `code` datastructures should have `__repr__` that will make a readable preview.

   - Implement proper logging with `logger` instead of `print`
