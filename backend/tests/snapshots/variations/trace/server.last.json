{
  "000": {
    "direction": "client->server",
    "data": {
      "id": 0,
      "params": {
        "capabilities": {},
        "processId": null,
        "rootPath": null,
        "rootUri": "file://{cwd}/tests/inputs/codebase",
        "workspaceFolders": [
          { "uri": "file://{cwd}/tests/inputs/codebase",
            "name": "codebase" } ] },
      "method": "initialize",
      "jsonrpc": "2.0" } },
  "001": {
    "direction": "server->client",
    "data": {
      "id": 0,
      "jsonrpc": "2.0",
      "result": {
        "capabilities": {
          "positionEncoding": "PositionEncodingKind.Utf16",
          "textDocumentSync": {
            "openClose": true,
            "change": 2,
            "save": false },
          "documentFormattingProvider": true,
          "executeCommandProvider": { "commands": [] },
          "workspace": {
            "workspaceFolders": {
              "supported": true,
              "changeNotifications": true },
            "fileOperations": {} } },
        "serverInfo": {
          "name": "sql-refinery-server",
          "version": "0.1-dev" } } } },
  "002": {
    "direction": "client->server",
    "data": {
      "params": {},
      "method": "initialized",
      "jsonrpc": "2.0" } },
  "003": {
    "direction": "client->server",
    "data": {
      "params": {
        "textDocument": {
          "uri": "file://{cwd}/tests/inputs/editor.sql",
          "languageId": "sql",
          "version": 1,
          "text": "{contents}" } },
      "method": "textDocument/didOpen",
      "jsonrpc": "2.0" } },
  "004": {
    "direction": "server->client",
    "data": {
      "method": "sql-refinery/variations",
      "jsonrpc": "2.0",
      "params": {
        "uri": "file://{cwd}/tests/inputs/editor.sql",
        "variations": [
          { "this": {
              "columns": [
                { "dataset": null,
                  "table": "c",
                  "column": "region",
                  "location": {
                    "file": "{cwd}/tests/inputs/editor.sql",
                    "range": {
                      "start_line": 6,
                      "start_char": 13,
                      "end_line": 6,
                      "end_char": 21 } } },
                { "dataset": null,
                  "table": "c",
                  "column": "region",
                  "location": {
                    "file": "{cwd}/tests/inputs/editor.sql",
                    "range": {
                      "start_line": 7,
                      "start_char": 13,
                      "end_line": 7,
                      "end_char": 21 } } },
                { "dataset": null,
                  "table": "c",
                  "column": "region",
                  "location": {
                    "file": "{cwd}/tests/inputs/editor.sql",
                    "range": {
                      "start_line": 8,
                      "start_char": 13,
                      "end_line": 8,
                      "end_char": 21 } } } ],
              "alias": "macro_region",
              "location": {
                "file": "{cwd}/tests/inputs/editor.sql",
                "range": {
                  "start_line": 5,
                  "start_char": 4,
                  "end_line": 10,
                  "end_char": 7 } },
              "sql": "CASE\n        WHEN c.region IN ('Americas') THEN 'AMER'\n        WHEN c.region IN ('Europe', 'Africa') THEN 'EMEA'\n        WHEN c.region = 'Asia' THEN 'APAC'\n        ELSE NULL\n    END" },
            "others": [
              { "group": {
                  "locations": [
                    { "file": "{cwd}/tests/inputs/codebase/0-accounts.sql",
                      "range": {
                        "start_line": 97,
                        "start_char": 8,
                        "end_line": 101,
                        "end_char": 11 } },
                    { "file": "{cwd}/tests/inputs/codebase/1-revenue.sql",
                      "range": {
                        "start_line": 6,
                        "start_char": 4,
                        "end_line": 10,
                        "end_char": 7 } },
                    { "file": "{cwd}/tests/inputs/codebase/1-revenue.sql",
                      "range": {
                        "start_line": 32,
                        "start_char": 4,
                        "end_line": 36,
                        "end_char": 7 } } ],
                  "columns": [
                    { "dataset": null,
                      "table": "countries",
                      "column": "region" } ],
                  "frequency": 3,
                  "canonical": "Casewhen_expression(Casewhen_clause(In(?.countries.region, Struct('Americas', 'Europe')), 'North-West'), Casewhen_clause(In(?.countries.region, Struct('Africa', 'Asia')), 'South-East'), Caseelse_clause(Null()))",
                  "sql": "CASE\n            WHEN c.region IN ('Americas', 'Europe') THEN 'North-West'\n            WHEN c.region IN ('Africa', 'Asia') THEN 'South-East'\n            ELSE NULL\n        END" },
                "similarity": 0.7633928571428572 } ] },
          { "this": {
              "columns": [
                { "dataset": null,
                  "table": "a",
                  "column": "industry",
                  "location": {
                    "file": "{cwd}/tests/inputs/editor.sql",
                    "range": {
                      "start_line": 12,
                      "start_char": 8,
                      "end_line": 12,
                      "end_char": 18 } } } ],
              "alias": "industry_it",
              "location": {
                "file": "{cwd}/tests/inputs/editor.sql",
                "range": {
                  "start_line": 12,
                  "start_char": 4,
                  "end_line": 12,
                  "end_char": 62 } },
              "sql": "IIF(a.industry = 'Information Technology', 'IT', 'Non-IT')" },
            "others": [
              { "group": {
                  "locations": [
                    { "file": "{cwd}/tests/inputs/codebase/1-revenue.sql",
                      "range": {
                        "start_line": 38,
                        "start_char": 4,
                        "end_line": 38,
                        "end_char": 70 } } ],
                  "columns": [
                    { "dataset": null,
                      "table": "accounts",
                      "column": "industry" } ],
                  "frequency": 1,
                  "canonical": "Function_call(Identifier, Argument(=(?.accounts.industry, 'Information Technology')), Argument('Tech'), Argument('Other'))",
                  "sql": "IIF(accounts.industry = 'Information Technology', 'Tech', 'Other')" },
                "similarity": 0.9382716049382716 } ] } ] } } },
  "005": {
    "direction": "client->server",
    "data": {
      "params": {
        "textDocument": {
          "uri": "file://{cwd}/tests/inputs/codebase/1-revenue.sql",
          "languageId": "sql",
          "version": 1,
          "text": "{contents}" } },
      "method": "textDocument/didOpen",
      "jsonrpc": "2.0" } },
  "006": {
    "direction": "server->client",
    "data": {
      "method": "sql-refinery/variations",
      "jsonrpc": "2.0",
      "params": {
        "uri": "file://{cwd}/tests/inputs/codebase/1-revenue.sql",
        "variations": [
          { "this": {
              "columns": [
                { "dataset": null,
                  "table": "c",
                  "column": "region",
                  "location": {
                    "file": "{cwd}/tests/inputs/codebase/1-revenue.sql",
                    "range": {
                      "start_line": 7,
                      "start_char": 13,
                      "end_line": 7,
                      "end_char": 21 } } },
                { "dataset": null,
                  "table": "c",
                  "column": "region",
                  "location": {
                    "file": "{cwd}/tests/inputs/codebase/1-revenue.sql",
                    "range": {
                      "start_line": 8,
                      "start_char": 13,
                      "end_line": 8,
                      "end_char": 21 } } } ],
              "alias": "region_cluster",
              "location": {
                "file": "{cwd}/tests/inputs/codebase/1-revenue.sql",
                "range": {
                  "start_line": 6,
                  "start_char": 4,
                  "end_line": 10,
                  "end_char": 7 } },
              "sql": "CASE\n        WHEN c.region IN ('Americas', 'Europe') THEN 'North-West'\n        WHEN c.region IN ('Africa', 'Asia') THEN 'South-East'\n        ELSE NULL\n    END" },
            "others": [
              { "group": {
                  "locations": [
                    { "file": "{cwd}/tests/inputs/editor.sql",
                      "range": {
                        "start_line": 5,
                        "start_char": 4,
                        "end_line": 10,
                        "end_char": 7 } } ],
                  "columns": [
                    { "dataset": null,
                      "table": "countries",
                      "column": "region" } ],
                  "frequency": 1,
                  "canonical": "Casewhen_expression(Casewhen_clause(In(?.countries.region, 'Americas'), 'AMER'), Casewhen_clause(In(?.countries.region, Struct('Europe', 'Africa')), 'EMEA'), Casewhen_clause(=(?.countries.region, 'Asia'), 'APAC'), Caseelse_clause(Null()))",
                  "sql": "CASE\n        WHEN c.region IN ('Americas') THEN 'AMER'\n        WHEN c.region IN ('Europe', 'Africa') THEN 'EMEA'\n        WHEN c.region = 'Asia' THEN 'APAC'\n        ELSE NULL\n    END" },
                "similarity": 0.7633928571428572 } ] },
          { "this": {
              "columns": [
                { "dataset": null,
                  "table": "c",
                  "column": "region",
                  "location": {
                    "file": "{cwd}/tests/inputs/codebase/1-revenue.sql",
                    "range": {
                      "start_line": 33,
                      "start_char": 13,
                      "end_line": 33,
                      "end_char": 21 } } },
                { "dataset": null,
                  "table": "c",
                  "column": "region",
                  "location": {
                    "file": "{cwd}/tests/inputs/codebase/1-revenue.sql",
                    "range": {
                      "start_line": 34,
                      "start_char": 13,
                      "end_line": 34,
                      "end_char": 21 } } } ],
              "alias": "cluster",
              "location": {
                "file": "{cwd}/tests/inputs/codebase/1-revenue.sql",
                "range": {
                  "start_line": 32,
                  "start_char": 4,
                  "end_line": 36,
                  "end_char": 7 } },
              "sql": "CASE\n        WHEN c.region IN ('Americas', 'Europe') THEN 'North-West'\n        WHEN c.region IN ('Africa', 'Asia') THEN 'South-East'\n        ELSE NULL\n    END" },
            "others": [
              { "group": {
                  "locations": [
                    { "file": "{cwd}/tests/inputs/editor.sql",
                      "range": {
                        "start_line": 5,
                        "start_char": 4,
                        "end_line": 10,
                        "end_char": 7 } } ],
                  "columns": [
                    { "dataset": null,
                      "table": "countries",
                      "column": "region" } ],
                  "frequency": 1,
                  "canonical": "Casewhen_expression(Casewhen_clause(In(?.countries.region, 'Americas'), 'AMER'), Casewhen_clause(In(?.countries.region, Struct('Europe', 'Africa')), 'EMEA'), Casewhen_clause(=(?.countries.region, 'Asia'), 'APAC'), Caseelse_clause(Null()))",
                  "sql": "CASE\n        WHEN c.region IN ('Americas') THEN 'AMER'\n        WHEN c.region IN ('Europe', 'Africa') THEN 'EMEA'\n        WHEN c.region = 'Asia' THEN 'APAC'\n        ELSE NULL\n    END" },
                "similarity": 0.7633928571428572 } ] },
          { "this": {
              "columns": [
                { "dataset": null,
                  "table": "accounts",
                  "column": "industry",
                  "location": {
                    "file": "{cwd}/tests/inputs/codebase/1-revenue.sql",
                    "range": {
                      "start_line": 38,
                      "start_char": 8,
                      "end_line": 38,
                      "end_char": 25 } } } ],
              "alias": "industry_tech",
              "location": {
                "file": "{cwd}/tests/inputs/codebase/1-revenue.sql",
                "range": {
                  "start_line": 38,
                  "start_char": 4,
                  "end_line": 38,
                  "end_char": 70 } },
              "sql": "IIF(accounts.industry = 'Information Technology', 'Tech', 'Other')" },
            "others": [
              { "group": {
                  "locations": [
                    { "file": "{cwd}/tests/inputs/editor.sql",
                      "range": {
                        "start_line": 12,
                        "start_char": 4,
                        "end_line": 12,
                        "end_char": 62 } } ],
                  "columns": [
                    { "dataset": null,
                      "table": "accounts",
                      "column": "industry" } ],
                  "frequency": 1,
                  "canonical": "Function_call(Identifier, Argument(=(?.accounts.industry, 'Information Technology')), Argument('IT'), Argument('Non-IT'))",
                  "sql": "IIF(a.industry = 'Information Technology', 'IT', 'Non-IT')" },
                "similarity": 0.9382716049382716 } ] } ] } } },
  "007": {
    "direction": "client->server",
    "data": {
      "params": {
        "textDocument": {
          "uri": "file://{cwd}/tests/inputs/codebase/0-accounts.sql",
          "languageId": "sql",
          "version": 1,
          "text": "{contents}" } },
      "method": "textDocument/didOpen",
      "jsonrpc": "2.0" } },
  "008": {
    "direction": "server->client",
    "data": {
      "method": "sql-refinery/variations",
      "jsonrpc": "2.0",
      "params": {
        "uri": "file://{cwd}/tests/inputs/codebase/0-accounts.sql",
        "variations": [
          { "this": {
              "columns": [
                { "dataset": null,
                  "table": "o",
                  "column": "product",
                  "location": {
                    "file": "{cwd}/tests/inputs/codebase/0-accounts.sql",
                    "range": {
                      "start_line": 37,
                      "start_char": 22,
                      "end_line": 37,
                      "end_char": 31 } } },
                { "dataset": null,
                  "table": "o",
                  "column": "value",
                  "location": {
                    "file": "{cwd}/tests/inputs/codebase/0-accounts.sql",
                    "range": {
                      "start_line": 37,
                      "start_char": 86,
                      "end_line": 37,
                      "end_char": 93 } } } ],
              "alias": "revenue_core",
              "location": {
                "file": "{cwd}/tests/inputs/codebase/0-accounts.sql",
                "range": {
                  "start_line": 37,
                  "start_char": 8,
                  "end_line": 37,
                  "end_char": 105 } },
              "sql": "SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END)" },
            "others": [
              { "group": {
                  "locations": [
                    { "file": "{cwd}/tests/inputs/codebase/0-accounts.sql",
                      "range": {
                        "start_line": 38,
                        "start_char": 8,
                        "end_line": 38,
                        "end_char": 86 } } ],
                  "columns": [
                    { "dataset": null,
                      "table": "orders",
                      "column": "product" },
                    { "dataset": null,
                      "table": "orders",
                      "column": "value" } ],
                  "frequency": 1,
                  "canonical": "Function_call(Identifier, Argument(Casewhen_expression(Casewhen_clause(In(?.orders.product, Struct('Training', 'Consulting')), ?.orders.value), Caseelse_clause(0))))",
                  "sql": "SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END)" },
                "similarity": 0.8882521489971347 } ] },
          { "this": {
              "columns": [
                { "dataset": null,
                  "table": "o",
                  "column": "product",
                  "location": {
                    "file": "{cwd}/tests/inputs/codebase/0-accounts.sql",
                    "range": {
                      "start_line": 38,
                      "start_char": 22,
                      "end_line": 38,
                      "end_char": 31 } } },
                { "dataset": null,
                  "table": "o",
                  "column": "value",
                  "location": {
                    "file": "{cwd}/tests/inputs/codebase/0-accounts.sql",
                    "range": {
                      "start_line": 38,
                      "start_char": 67,
                      "end_line": 38,
                      "end_char": 74 } } } ],
              "alias": "revenue_aux",
              "location": {
                "file": "{cwd}/tests/inputs/codebase/0-accounts.sql",
                "range": {
                  "start_line": 38,
                  "start_char": 8,
                  "end_line": 38,
                  "end_char": 86 } },
              "sql": "SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END)" },
            "others": [
              { "group": {
                  "locations": [
                    { "file": "{cwd}/tests/inputs/codebase/0-accounts.sql",
                      "range": {
                        "start_line": 37,
                        "start_char": 8,
                        "end_line": 37,
                        "end_char": 105 } } ],
                  "columns": [
                    { "dataset": null,
                      "table": "orders",
                      "column": "product" },
                    { "dataset": null,
                      "table": "orders",
                      "column": "value" } ],
                  "frequency": 1,
                  "canonical": "Function_call(Identifier, Argument(Casewhen_expression(Casewhen_clause(In(?.orders.product, Struct('Subscription Base', 'Subscription Premium')), ?.orders.value), Caseelse_clause(0))))",
                  "sql": "SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END)" },
                "similarity": 0.8882521489971347 } ] },
          { "this": {
              "columns": [
                { "dataset": null,
                  "table": "c",
                  "column": "region",
                  "location": {
                    "file": "{cwd}/tests/inputs/codebase/0-accounts.sql",
                    "range": {
                      "start_line": 98,
                      "start_char": 17,
                      "end_line": 98,
                      "end_char": 25 } } },
                { "dataset": null,
                  "table": "c",
                  "column": "region",
                  "location": {
                    "file": "{cwd}/tests/inputs/codebase/0-accounts.sql",
                    "range": {
                      "start_line": 99,
                      "start_char": 17,
                      "end_line": 99,
                      "end_char": 25 } } } ],
              "alias": "region_cluster",
              "location": {
                "file": "{cwd}/tests/inputs/codebase/0-accounts.sql",
                "range": {
                  "start_line": 97,
                  "start_char": 8,
                  "end_line": 101,
                  "end_char": 11 } },
              "sql": "CASE\n            WHEN c.region IN ('Americas', 'Europe') THEN 'North-West'\n            WHEN c.region IN ('Africa', 'Asia') THEN 'South-East'\n            ELSE NULL\n        END" },
            "others": [
              { "group": {
                  "locations": [
                    { "file": "{cwd}/tests/inputs/editor.sql",
                      "range": {
                        "start_line": 5,
                        "start_char": 4,
                        "end_line": 10,
                        "end_char": 7 } } ],
                  "columns": [
                    { "dataset": null,
                      "table": "countries",
                      "column": "region" } ],
                  "frequency": 1,
                  "canonical": "Casewhen_expression(Casewhen_clause(In(?.countries.region, 'Americas'), 'AMER'), Casewhen_clause(In(?.countries.region, Struct('Europe', 'Africa')), 'EMEA'), Casewhen_clause(=(?.countries.region, 'Asia'), 'APAC'), Caseelse_clause(Null()))",
                  "sql": "CASE\n        WHEN c.region IN ('Americas') THEN 'AMER'\n        WHEN c.region IN ('Europe', 'Africa') THEN 'EMEA'\n        WHEN c.region = 'Asia' THEN 'APAC'\n        ELSE NULL\n    END" },
                "similarity": 0.7633928571428572 } ] } ] } } },
  "009": {
    "direction": "client->server",
    "data": {
      "params": {
        "textDocument": { "uri": "file://{cwd}/tests/inputs/codebase/0-accounts.sql" } },
      "method": "textDocument/didClose",
      "jsonrpc": "2.0" } },
  "010": {
    "direction": "client->server",
    "data": {
      "params": {
        "textDocument": { "uri": "file://{cwd}/tests/inputs/editor.sql" } },
      "method": "textDocument/didClose",
      "jsonrpc": "2.0" } },
  "011": {
    "direction": "client->server",
    "data": {
      "params": {
        "textDocument": { "uri": "file://{cwd}/tests/inputs/codebase/1-revenue.sql" } },
      "method": "textDocument/didClose",
      "jsonrpc": "2.0" } },
  "012": {
    "direction": "client->server",
    "data": {
      "id": 5,
      "method": "shutdown",
      "jsonrpc": "2.0" } },
  "013": {
    "direction": "server->client",
    "data": {
      "id": 5,
      "jsonrpc": "2.0",
      "result": null } },
  "014": null }