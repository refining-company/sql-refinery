[{"root": {"type": "source_file", "text": "DROP TABLE IF EXISTS date_ranges;\nCREATE TABLE date_ranges AS\nWITH RECURSIVE date_ranges(date_day) AS (\n    SELECT \n        date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)) AS date_month\n    FROM deals d\n    UNION ALL\n    SELECT \n        date(date_day, '+1 day')\n    FROM date_ranges\n    WHERE date_day < (SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)\n)\nSELECT \n    date_day\nFROM date_ranges\nGROUP BY date_day;\n\n", "children": [{"type": "drop_table_statement", "text": "DROP TABLE IF EXISTS date_ranges", "children": [{"type": "DROP", "text": "DROP", "children": []}, {"type": "TABLE", "text": "TABLE", "children": []}, {"type": "keyword_if_exists", "text": "IF EXISTS", "children": [{"type": "IF_EXISTS", "text": "IF", "children": []}, {"type": "IF_EXISTS", "text": "EXISTS", "children": []}]}, {"type": "identifier", "text": "date_ranges", "children": []}]}, {"type": ";", "text": ";", "children": []}, {"type": "create_table_statement", "text": "CREATE TABLE date_ranges AS\nWITH RECURSIVE date_ranges(date_day) AS (\n    SELECT \n        date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)) AS date_month\n    FROM deals d\n    UNION ALL\n    SELECT \n        date(date_day, '+1 day')\n    FROM date_ranges\n    WHERE date_day < (SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)\n)\nSELECT \n    date_day\nFROM date_ranges\nGROUP BY date_day", "children": [{"type": "CREATE", "text": "CREATE", "children": []}, {"type": "TABLE", "text": "TABLE", "children": []}, {"type": "identifier", "text": "date_ranges", "children": []}, {"type": "AS", "text": "AS", "children": []}, {"type": "query_statement", "text": "WITH RECURSIVE date_ranges(date_day) AS (\n    SELECT \n        date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)) AS date_month\n    FROM deals d\n    UNION ALL\n    SELECT \n        date(date_day, '+1 day')\n    FROM date_ranges\n    WHERE date_day < (SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)\n)\nSELECT \n    date_day\nFROM date_ranges\nGROUP BY date_day", "children": [{"type": "query_expr", "text": "WITH RECURSIVE date_ranges(date_day) AS (\n    SELECT \n        date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)) AS date_month\n    FROM deals d\n    UNION ALL\n    SELECT \n        date(date_day, '+1 day')\n    FROM date_ranges\n    WHERE date_day < (SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)\n)\nSELECT \n    date_day\nFROM date_ranges\nGROUP BY date_day", "children": [{"type": "cte_clause", "text": "WITH RECURSIVE date_ranges(date_day) AS (\n    SELECT \n        date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)) AS date_month\n    FROM deals d\n    UNION ALL\n    SELECT \n        date(date_day, '+1 day')\n    FROM date_ranges\n    WHERE date_day < (SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)\n)", "children": [{"type": "WITH", "text": "WITH", "children": []}, {"type": "with_recursive_keyword", "text": "RECURSIVE", "children": []}, {"type": "cte", "text": "date_ranges(date_day) AS (\n    SELECT \n        date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)) AS date_month\n    FROM deals d\n    UNION ALL\n    SELECT \n        date(date_day, '+1 day')\n    FROM date_ranges\n    WHERE date_day < (SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)\n)", "children": [{"type": "identifier", "text": "date_ranges", "children": []}, {"type": "ERROR", "text": "(date_day)", "children": [{"type": "(", "text": "(", "children": []}, {"type": ")", "text": ")", "children": []}]}, {"type": "AS", "text": "AS", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "query_expr", "text": "SELECT \n        date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)) AS date_month\n    FROM deals d\n    UNION ALL\n    SELECT \n        date(date_day, '+1 day')\n    FROM date_ranges\n    WHERE date_day < (SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)", "children": [{"type": "set_operation", "text": "SELECT \n        date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)) AS date_month\n    FROM deals d\n    UNION ALL\n    SELECT \n        date(date_day, '+1 day')\n    FROM date_ranges\n    WHERE date_day < (SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)", "children": [{"type": "query_expr", "text": "SELECT \n        date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)) AS date_month\n    FROM deals d", "children": [{"type": "select", "text": "SELECT \n        date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)) AS date_month\n    FROM deals d", "children": [{"type": "SELECT", "text": "SELECT", "children": []}, {"type": "select_list", "text": "date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)) AS date_month", "children": [{"type": "select_expression", "text": "date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)) AS date_month", "children": [{"type": "function_call", "text": "date(MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END))", "children": [{"type": "identifier", "text": "date", "children": [{"type": "DATE", "text": "date", "children": []}]}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)", "children": [{"type": "function_call", "text": "MIN(CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END)", "children": [{"type": "identifier", "text": "MIN", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END", "children": [{"type": "casewhen_expression", "text": "CASE WHEN d.stage_date < d.contract_start_date THEN d.stage_date ELSE d.contract_start_date END", "children": [{"type": "CASE", "text": "CASE", "children": []}, {"type": "casewhen_clause", "text": "WHEN d.stage_date < d.contract_start_date THEN d.stage_date", "children": [{"type": "WHEN", "text": "WHEN", "children": []}, {"type": "binary_expression", "text": "d.stage_date < d.contract_start_date", "children": [{"type": "identifier", "text": "d.stage_date", "children": [{"type": ".", "text": ".", "children": []}]}, {"type": "<", "text": "<", "children": []}, {"type": "identifier", "text": "d.contract_start_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": "THEN", "text": "THEN", "children": []}, {"type": "identifier", "text": "d.stage_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": "caseelse_clause", "text": "ELSE d.contract_start_date", "children": [{"type": "ELSE", "text": "ELSE", "children": []}, {"type": "identifier", "text": "d.contract_start_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": "END", "text": "END", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS date_month", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "date_month", "children": []}]}]}]}, {"type": "from_clause", "text": "FROM deals d", "children": [{"type": "FROM", "text": "FROM", "children": []}, {"type": "from_item", "text": "deals d", "children": [{"type": "identifier", "text": "deals", "children": []}, {"type": "as_alias", "text": "d", "children": [{"type": "identifier", "text": "d", "children": []}]}]}]}]}]}, {"type": "UNION_ALL", "text": "UNION", "children": []}, {"type": "UNION_ALL", "text": "ALL", "children": []}, {"type": "query_expr", "text": "SELECT \n        date(date_day, '+1 day')\n    FROM date_ranges\n    WHERE date_day < (SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)", "children": [{"type": "select", "text": "SELECT \n        date(date_day, '+1 day')\n    FROM date_ranges\n    WHERE date_day < (SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)", "children": [{"type": "SELECT", "text": "SELECT", "children": []}, {"type": "select_list", "text": "date(date_day, '+1 day')", "children": [{"type": "select_expression", "text": "date(date_day, '+1 day')", "children": [{"type": "function_call", "text": "date(date_day, '+1 day')", "children": [{"type": "identifier", "text": "date", "children": [{"type": "DATE", "text": "date", "children": []}]}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "date_day", "children": [{"type": "identifier", "text": "date_day", "children": []}]}, {"type": ",", "text": ",", "children": []}, {"type": "argument", "text": "'+1 day'", "children": [{"type": "string", "text": "'+1 day'", "children": []}]}, {"type": ")", "text": ")", "children": []}]}]}]}, {"type": "from_clause", "text": "FROM date_ranges", "children": [{"type": "FROM", "text": "FROM", "children": []}, {"type": "from_item", "text": "date_ranges", "children": [{"type": "identifier", "text": "date_ranges", "children": []}]}]}, {"type": "where_clause", "text": "WHERE date_day < (SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)", "children": [{"type": "WHERE", "text": "WHERE", "children": []}, {"type": "binary_expression", "text": "date_day < (SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)", "children": [{"type": "identifier", "text": "date_day", "children": []}, {"type": "<", "text": "<", "children": []}, {"type": "select_subexpression", "text": "(SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d)", "children": [{"type": "(", "text": "(", "children": []}, {"type": "query_expr", "text": "SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d", "children": [{"type": "select", "text": "SELECT date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)) FROM deals d", "children": [{"type": "SELECT", "text": "SELECT", "children": []}, {"type": "select_list", "text": "date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END))", "children": [{"type": "select_expression", "text": "date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END))", "children": [{"type": "function_call", "text": "date(MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END))", "children": [{"type": "identifier", "text": "date", "children": [{"type": "DATE", "text": "date", "children": []}]}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)", "children": [{"type": "function_call", "text": "MAX(CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END)", "children": [{"type": "identifier", "text": "MAX", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END", "children": [{"type": "casewhen_expression", "text": "CASE WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date ELSE d.stage_date END", "children": [{"type": "CASE", "text": "CASE", "children": []}, {"type": "casewhen_clause", "text": "WHEN d.contract_end_date > d.stage_date THEN d.contract_end_date", "children": [{"type": "WHEN", "text": "WHEN", "children": []}, {"type": "binary_expression", "text": "d.contract_end_date > d.stage_date", "children": [{"type": "identifier", "text": "d.contract_end_date", "children": [{"type": ".", "text": ".", "children": []}]}, {"type": ">", "text": ">", "children": []}, {"type": "identifier", "text": "d.stage_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": "THEN", "text": "THEN", "children": []}, {"type": "identifier", "text": "d.contract_end_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": "caseelse_clause", "text": "ELSE d.stage_date", "children": [{"type": "ELSE", "text": "ELSE", "children": []}, {"type": "identifier", "text": "d.stage_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": "END", "text": "END", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}]}]}, {"type": "from_clause", "text": "FROM deals d", "children": [{"type": "FROM", "text": "FROM", "children": []}, {"type": "from_item", "text": "deals d", "children": [{"type": "identifier", "text": "deals", "children": []}, {"type": "as_alias", "text": "d", "children": [{"type": "identifier", "text": "d", "children": []}]}]}]}]}]}, {"type": ")", "text": ")", "children": []}]}]}]}]}]}]}]}, {"type": ")", "text": ")", "children": []}]}]}, {"type": "select", "text": "SELECT \n    date_day\nFROM date_ranges\nGROUP BY date_day", "children": [{"type": "SELECT", "text": "SELECT", "children": []}, {"type": "select_list", "text": "date_day", "children": [{"type": "select_expression", "text": "date_day", "children": [{"type": "identifier", "text": "date_day", "children": []}]}]}, {"type": "from_clause", "text": "FROM date_ranges", "children": [{"type": "FROM", "text": "FROM", "children": []}, {"type": "from_item", "text": "date_ranges", "children": [{"type": "identifier", "text": "date_ranges", "children": []}]}]}, {"type": "group_by_clause", "text": "GROUP BY date_day", "children": [{"type": "GROUP_BY", "text": "GROUP", "children": []}, {"type": "GROUP_BY", "text": "BY", "children": []}, {"type": "grouping_item", "text": "date_day", "children": [{"type": "identifier", "text": "date_day", "children": []}]}]}]}]}]}]}, {"type": ";", "text": ";", "children": []}]}}, {"root": {"type": "source_file", "text": "DROP TABLE IF EXISTS deals_signed;\nCREATE TABLE deals_signed AS\nSELECT \n    *,\n    revenue / contract_duration_days AS revenue_day,\n    revenue_core / contract_duration_days AS revenue_core_day,\n    revenue_aux / contract_duration_days AS revenue_aux_day\nFROM (\n    SELECT \n        d.deal_id,\n        d.account_id,\n        d.contract_start_date,\n        d.contract_end_date,\n        julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1 AS contract_duration_days,\n        SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END) AS revenue_core,\n        SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END) AS revenue_aux,\n        SUM(o.value) AS revenue\n    FROM orders o\n    JOIN deals d USING (deal_id, order_id)\n    WHERE d.stage = 4\n    GROUP BY d.deal_id, d.account_id, d.contract_start_date, d.contract_end_date\n) AS t;\n\n", "children": [{"type": "drop_table_statement", "text": "DROP TABLE IF EXISTS deals_signed", "children": [{"type": "DROP", "text": "DROP", "children": []}, {"type": "TABLE", "text": "TABLE", "children": []}, {"type": "keyword_if_exists", "text": "IF EXISTS", "children": [{"type": "IF_EXISTS", "text": "IF", "children": []}, {"type": "IF_EXISTS", "text": "EXISTS", "children": []}]}, {"type": "identifier", "text": "deals_signed", "children": []}]}, {"type": ";", "text": ";", "children": []}, {"type": "create_table_statement", "text": "CREATE TABLE deals_signed AS\nSELECT \n    *,\n    revenue / contract_duration_days AS revenue_day,\n    revenue_core / contract_duration_days AS revenue_core_day,\n    revenue_aux / contract_duration_days AS revenue_aux_day\nFROM (\n    SELECT \n        d.deal_id,\n        d.account_id,\n        d.contract_start_date,\n        d.contract_end_date,\n        julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1 AS contract_duration_days,\n        SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END) AS revenue_core,\n        SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END) AS revenue_aux,\n        SUM(o.value) AS revenue\n    FROM orders o\n    JOIN deals d USING (deal_id, order_id)\n    WHERE d.stage = 4\n    GROUP BY d.deal_id, d.account_id, d.contract_start_date, d.contract_end_date\n) AS t", "children": [{"type": "CREATE", "text": "CREATE", "children": []}, {"type": "TABLE", "text": "TABLE", "children": []}, {"type": "identifier", "text": "deals_signed", "children": []}, {"type": "AS", "text": "AS", "children": []}, {"type": "query_statement", "text": "SELECT \n    *,\n    revenue / contract_duration_days AS revenue_day,\n    revenue_core / contract_duration_days AS revenue_core_day,\n    revenue_aux / contract_duration_days AS revenue_aux_day\nFROM (\n    SELECT \n        d.deal_id,\n        d.account_id,\n        d.contract_start_date,\n        d.contract_end_date,\n        julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1 AS contract_duration_days,\n        SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END) AS revenue_core,\n        SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END) AS revenue_aux,\n        SUM(o.value) AS revenue\n    FROM orders o\n    JOIN deals d USING (deal_id, order_id)\n    WHERE d.stage = 4\n    GROUP BY d.deal_id, d.account_id, d.contract_start_date, d.contract_end_date\n) AS t", "children": [{"type": "query_expr", "text": "SELECT \n    *,\n    revenue / contract_duration_days AS revenue_day,\n    revenue_core / contract_duration_days AS revenue_core_day,\n    revenue_aux / contract_duration_days AS revenue_aux_day\nFROM (\n    SELECT \n        d.deal_id,\n        d.account_id,\n        d.contract_start_date,\n        d.contract_end_date,\n        julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1 AS contract_duration_days,\n        SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END) AS revenue_core,\n        SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END) AS revenue_aux,\n        SUM(o.value) AS revenue\n    FROM orders o\n    JOIN deals d USING (deal_id, order_id)\n    WHERE d.stage = 4\n    GROUP BY d.deal_id, d.account_id, d.contract_start_date, d.contract_end_date\n) AS t", "children": [{"type": "select", "text": "SELECT \n    *,\n    revenue / contract_duration_days AS revenue_day,\n    revenue_core / contract_duration_days AS revenue_core_day,\n    revenue_aux / contract_duration_days AS revenue_aux_day\nFROM (\n    SELECT \n        d.deal_id,\n        d.account_id,\n        d.contract_start_date,\n        d.contract_end_date,\n        julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1 AS contract_duration_days,\n        SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END) AS revenue_core,\n        SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END) AS revenue_aux,\n        SUM(o.value) AS revenue\n    FROM orders o\n    JOIN deals d USING (deal_id, order_id)\n    WHERE d.stage = 4\n    GROUP BY d.deal_id, d.account_id, d.contract_start_date, d.contract_end_date\n) AS t", "children": [{"type": "SELECT", "text": "SELECT", "children": []}, {"type": "select_list", "text": "*,\n    revenue / contract_duration_days AS revenue_day,\n    revenue_core / contract_duration_days AS revenue_core_day,\n    revenue_aux / contract_duration_days AS revenue_aux_day", "children": [{"type": "select_all", "text": "*", "children": [{"type": "asterisk_expression", "text": "*", "children": [{"type": "*", "text": "*", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "revenue / contract_duration_days AS revenue_day", "children": [{"type": "binary_expression", "text": "revenue / contract_duration_days", "children": [{"type": "identifier", "text": "revenue", "children": []}, {"type": "/", "text": "/", "children": []}, {"type": "identifier", "text": "contract_duration_days", "children": []}]}, {"type": "as_alias", "text": "AS revenue_day", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue_day", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "revenue_core / contract_duration_days AS revenue_core_day", "children": [{"type": "binary_expression", "text": "revenue_core / contract_duration_days", "children": [{"type": "identifier", "text": "revenue_core", "children": []}, {"type": "/", "text": "/", "children": []}, {"type": "identifier", "text": "contract_duration_days", "children": []}]}, {"type": "as_alias", "text": "AS revenue_core_day", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue_core_day", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "revenue_aux / contract_duration_days AS revenue_aux_day", "children": [{"type": "binary_expression", "text": "revenue_aux / contract_duration_days", "children": [{"type": "identifier", "text": "revenue_aux", "children": []}, {"type": "/", "text": "/", "children": []}, {"type": "identifier", "text": "contract_duration_days", "children": []}]}, {"type": "as_alias", "text": "AS revenue_aux_day", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue_aux_day", "children": []}]}]}]}, {"type": "from_clause", "text": "FROM (\n    SELECT \n        d.deal_id,\n        d.account_id,\n        d.contract_start_date,\n        d.contract_end_date,\n        julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1 AS contract_duration_days,\n        SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END) AS revenue_core,\n        SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END) AS revenue_aux,\n        SUM(o.value) AS revenue\n    FROM orders o\n    JOIN deals d USING (deal_id, order_id)\n    WHERE d.stage = 4\n    GROUP BY d.deal_id, d.account_id, d.contract_start_date, d.contract_end_date\n) AS t", "children": [{"type": "FROM", "text": "FROM", "children": []}, {"type": "from_item", "text": "(\n    SELECT \n        d.deal_id,\n        d.account_id,\n        d.contract_start_date,\n        d.contract_end_date,\n        julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1 AS contract_duration_days,\n        SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END) AS revenue_core,\n        SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END) AS revenue_aux,\n        SUM(o.value) AS revenue\n    FROM orders o\n    JOIN deals d USING (deal_id, order_id)\n    WHERE d.stage = 4\n    GROUP BY d.deal_id, d.account_id, d.contract_start_date, d.contract_end_date\n) AS t", "children": [{"type": "select_subexpression", "text": "(\n    SELECT \n        d.deal_id,\n        d.account_id,\n        d.contract_start_date,\n        d.contract_end_date,\n        julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1 AS contract_duration_days,\n        SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END) AS revenue_core,\n        SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END) AS revenue_aux,\n        SUM(o.value) AS revenue\n    FROM orders o\n    JOIN deals d USING (deal_id, order_id)\n    WHERE d.stage = 4\n    GROUP BY d.deal_id, d.account_id, d.contract_start_date, d.contract_end_date\n)", "children": [{"type": "(", "text": "(", "children": []}, {"type": "query_expr", "text": "SELECT \n        d.deal_id,\n        d.account_id,\n        d.contract_start_date,\n        d.contract_end_date,\n        julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1 AS contract_duration_days,\n        SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END) AS revenue_core,\n        SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END) AS revenue_aux,\n        SUM(o.value) AS revenue\n    FROM orders o\n    JOIN deals d USING (deal_id, order_id)\n    WHERE d.stage = 4\n    GROUP BY d.deal_id, d.account_id, d.contract_start_date, d.contract_end_date", "children": [{"type": "select", "text": "SELECT \n        d.deal_id,\n        d.account_id,\n        d.contract_start_date,\n        d.contract_end_date,\n        julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1 AS contract_duration_days,\n        SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END) AS revenue_core,\n        SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END) AS revenue_aux,\n        SUM(o.value) AS revenue\n    FROM orders o\n    JOIN deals d USING (deal_id, order_id)\n    WHERE d.stage = 4\n    GROUP BY d.deal_id, d.account_id, d.contract_start_date, d.contract_end_date", "children": [{"type": "SELECT", "text": "SELECT", "children": []}, {"type": "select_list", "text": "d.deal_id,\n        d.account_id,\n        d.contract_start_date,\n        d.contract_end_date,\n        julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1 AS contract_duration_days,\n        SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END) AS revenue_core,\n        SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END) AS revenue_aux,\n        SUM(o.value) AS revenue", "children": [{"type": "select_expression", "text": "d.deal_id", "children": [{"type": "identifier", "text": "d.deal_id", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "d.account_id", "children": [{"type": "identifier", "text": "d.account_id", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "d.contract_start_date", "children": [{"type": "identifier", "text": "d.contract_start_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "d.contract_end_date", "children": [{"type": "identifier", "text": "d.contract_end_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1 AS contract_duration_days", "children": [{"type": "binary_expression", "text": "julianday(d.contract_end_date) - julianday(d.contract_start_date) + 1", "children": [{"type": "binary_expression", "text": "julianday(d.contract_end_date) - julianday(d.contract_start_date)", "children": [{"type": "function_call", "text": "julianday(d.contract_end_date)", "children": [{"type": "identifier", "text": "julianday", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "d.contract_end_date", "children": [{"type": "identifier", "text": "d.contract_end_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "-", "text": "-", "children": []}, {"type": "function_call", "text": "julianday(d.contract_start_date)", "children": [{"type": "identifier", "text": "julianday", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "d.contract_start_date", "children": [{"type": "identifier", "text": "d.contract_start_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}]}, {"type": "+", "text": "+", "children": []}, {"type": "number", "text": "1", "children": []}]}, {"type": "as_alias", "text": "AS contract_duration_days", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "contract_duration_days", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END) AS revenue_core", "children": [{"type": "function_call", "text": "SUM(CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END)", "children": [{"type": "identifier", "text": "SUM", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END", "children": [{"type": "casewhen_expression", "text": "CASE WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value ELSE 0 END", "children": [{"type": "CASE", "text": "CASE", "children": []}, {"type": "casewhen_clause", "text": "WHEN o.product IN ('Subscription Base', 'Subscription Premium') THEN o.value", "children": [{"type": "WHEN", "text": "WHEN", "children": []}, {"type": "binary_expression", "text": "o.product IN ('Subscription Base', 'Subscription Premium')", "children": [{"type": "identifier", "text": "o.product", "children": [{"type": ".", "text": ".", "children": []}]}, {"type": "IN", "text": "IN", "children": []}, {"type": "struct", "text": "('Subscription Base', 'Subscription Premium')", "children": [{"type": "(", "text": "(", "children": []}, {"type": "string", "text": "'Subscription Base'", "children": []}, {"type": ",", "text": ",", "children": []}, {"type": "string", "text": "'Subscription Premium'", "children": []}, {"type": ")", "text": ")", "children": []}]}]}, {"type": "THEN", "text": "THEN", "children": []}, {"type": "identifier", "text": "o.value", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": "caseelse_clause", "text": "ELSE 0", "children": [{"type": "ELSE", "text": "ELSE", "children": []}, {"type": "number", "text": "0", "children": []}]}, {"type": "END", "text": "END", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS revenue_core", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue_core", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END) AS revenue_aux", "children": [{"type": "function_call", "text": "SUM(CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END)", "children": [{"type": "identifier", "text": "SUM", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END", "children": [{"type": "casewhen_expression", "text": "CASE WHEN o.product IN ('Training', 'Consulting') THEN o.value ELSE 0 END", "children": [{"type": "CASE", "text": "CASE", "children": []}, {"type": "casewhen_clause", "text": "WHEN o.product IN ('Training', 'Consulting') THEN o.value", "children": [{"type": "WHEN", "text": "WHEN", "children": []}, {"type": "binary_expression", "text": "o.product IN ('Training', 'Consulting')", "children": [{"type": "identifier", "text": "o.product", "children": [{"type": ".", "text": ".", "children": []}]}, {"type": "IN", "text": "IN", "children": []}, {"type": "struct", "text": "('Training', 'Consulting')", "children": [{"type": "(", "text": "(", "children": []}, {"type": "string", "text": "'Training'", "children": []}, {"type": ",", "text": ",", "children": []}, {"type": "string", "text": "'Consulting'", "children": []}, {"type": ")", "text": ")", "children": []}]}]}, {"type": "THEN", "text": "THEN", "children": []}, {"type": "identifier", "text": "o.value", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": "caseelse_clause", "text": "ELSE 0", "children": [{"type": "ELSE", "text": "ELSE", "children": []}, {"type": "number", "text": "0", "children": []}]}, {"type": "END", "text": "END", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS revenue_aux", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue_aux", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "SUM(o.value) AS revenue", "children": [{"type": "function_call", "text": "SUM(o.value)", "children": [{"type": "identifier", "text": "SUM", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "o.value", "children": [{"type": "identifier", "text": "o.value", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS revenue", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue", "children": []}]}]}]}, {"type": "from_clause", "text": "FROM orders o\n    JOIN deals d USING (deal_id, order_id)", "children": [{"type": "FROM", "text": "FROM", "children": []}, {"type": "from_item", "text": "orders o\n    JOIN deals d USING (deal_id, order_id)", "children": [{"type": "join_operation", "text": "orders o\n    JOIN deals d USING (deal_id, order_id)", "children": [{"type": "from_item", "text": "orders o", "children": [{"type": "identifier", "text": "orders", "children": []}, {"type": "as_alias", "text": "o", "children": [{"type": "identifier", "text": "o", "children": []}]}]}, {"type": "JOIN", "text": "JOIN", "children": []}, {"type": "from_item", "text": "deals d", "children": [{"type": "identifier", "text": "deals", "children": []}, {"type": "as_alias", "text": "d", "children": [{"type": "identifier", "text": "d", "children": []}]}]}, {"type": "join_condition", "text": "USING (deal_id, order_id)", "children": [{"type": "USING", "text": "USING", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "identifier", "text": "deal_id", "children": []}, {"type": ",", "text": ",", "children": []}, {"type": "identifier", "text": "order_id", "children": []}, {"type": ")", "text": ")", "children": []}]}]}]}]}, {"type": "where_clause", "text": "WHERE d.stage = 4", "children": [{"type": "WHERE", "text": "WHERE", "children": []}, {"type": "binary_expression", "text": "d.stage = 4", "children": [{"type": "identifier", "text": "d.stage", "children": [{"type": ".", "text": ".", "children": []}]}, {"type": "=", "text": "=", "children": []}, {"type": "number", "text": "4", "children": []}]}]}, {"type": "group_by_clause", "text": "GROUP BY d.deal_id, d.account_id, d.contract_start_date, d.contract_end_date", "children": [{"type": "GROUP_BY", "text": "GROUP", "children": []}, {"type": "GROUP_BY", "text": "BY", "children": []}, {"type": "grouping_item", "text": "d.deal_id", "children": [{"type": "identifier", "text": "d.deal_id", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "grouping_item", "text": "d.account_id", "children": [{"type": "identifier", "text": "d.account_id", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "grouping_item", "text": "d.contract_start_date", "children": [{"type": "identifier", "text": "d.contract_start_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "grouping_item", "text": "d.contract_end_date", "children": [{"type": "identifier", "text": "d.contract_end_date", "children": [{"type": ".", "text": ".", "children": []}]}]}]}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS t", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "t", "children": []}]}]}]}]}]}]}]}, {"type": ";", "text": ";", "children": []}]}}, {"root": {"type": "source_file", "text": "DROP TABLE IF EXISTS accounts_revenue;\nCREATE TABLE accounts_revenue AS\nSELECT \n    t.date_month,\n    t.account_id,\n    AVG(t.deals) AS deals,\n    SUM(t.revenue_core) AS revenue_core,\n    SUM(t.revenue_aux) AS revenue_aux,\n    SUM(t.revenue) AS revenue\nFROM (\n    SELECT \n        dr.date_day,\n        DATE(date_day, 'start of month') AS date_month,\n        ds.account_id,\n        COUNT(ds.deal_id) AS deals,\n        SUM(ds.revenue_core_day) AS revenue_core,\n        SUM(ds.revenue_aux_day) AS revenue_aux,\n        SUM(ds.revenue_day) AS revenue\n    FROM date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)\n    GROUP BY dr.date_day, ds.account_id) t\nGROUP BY account_id, date_month;\n\n", "children": [{"type": "drop_table_statement", "text": "DROP TABLE IF EXISTS accounts_revenue", "children": [{"type": "DROP", "text": "DROP", "children": []}, {"type": "TABLE", "text": "TABLE", "children": []}, {"type": "keyword_if_exists", "text": "IF EXISTS", "children": [{"type": "IF_EXISTS", "text": "IF", "children": []}, {"type": "IF_EXISTS", "text": "EXISTS", "children": []}]}, {"type": "identifier", "text": "accounts_revenue", "children": []}]}, {"type": ";", "text": ";", "children": []}, {"type": "create_table_statement", "text": "CREATE TABLE accounts_revenue AS\nSELECT \n    t.date_month,\n    t.account_id,\n    AVG(t.deals) AS deals,\n    SUM(t.revenue_core) AS revenue_core,\n    SUM(t.revenue_aux) AS revenue_aux,\n    SUM(t.revenue) AS revenue\nFROM (\n    SELECT \n        dr.date_day,\n        DATE(date_day, 'start of month') AS date_month,\n        ds.account_id,\n        COUNT(ds.deal_id) AS deals,\n        SUM(ds.revenue_core_day) AS revenue_core,\n        SUM(ds.revenue_aux_day) AS revenue_aux,\n        SUM(ds.revenue_day) AS revenue\n    FROM date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)\n    GROUP BY dr.date_day, ds.account_id) t\nGROUP BY account_id, date_month", "children": [{"type": "CREATE", "text": "CREATE", "children": []}, {"type": "TABLE", "text": "TABLE", "children": []}, {"type": "identifier", "text": "accounts_revenue", "children": []}, {"type": "AS", "text": "AS", "children": []}, {"type": "query_statement", "text": "SELECT \n    t.date_month,\n    t.account_id,\n    AVG(t.deals) AS deals,\n    SUM(t.revenue_core) AS revenue_core,\n    SUM(t.revenue_aux) AS revenue_aux,\n    SUM(t.revenue) AS revenue\nFROM (\n    SELECT \n        dr.date_day,\n        DATE(date_day, 'start of month') AS date_month,\n        ds.account_id,\n        COUNT(ds.deal_id) AS deals,\n        SUM(ds.revenue_core_day) AS revenue_core,\n        SUM(ds.revenue_aux_day) AS revenue_aux,\n        SUM(ds.revenue_day) AS revenue\n    FROM date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)\n    GROUP BY dr.date_day, ds.account_id) t\nGROUP BY account_id, date_month", "children": [{"type": "query_expr", "text": "SELECT \n    t.date_month,\n    t.account_id,\n    AVG(t.deals) AS deals,\n    SUM(t.revenue_core) AS revenue_core,\n    SUM(t.revenue_aux) AS revenue_aux,\n    SUM(t.revenue) AS revenue\nFROM (\n    SELECT \n        dr.date_day,\n        DATE(date_day, 'start of month') AS date_month,\n        ds.account_id,\n        COUNT(ds.deal_id) AS deals,\n        SUM(ds.revenue_core_day) AS revenue_core,\n        SUM(ds.revenue_aux_day) AS revenue_aux,\n        SUM(ds.revenue_day) AS revenue\n    FROM date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)\n    GROUP BY dr.date_day, ds.account_id) t\nGROUP BY account_id, date_month", "children": [{"type": "select", "text": "SELECT \n    t.date_month,\n    t.account_id,\n    AVG(t.deals) AS deals,\n    SUM(t.revenue_core) AS revenue_core,\n    SUM(t.revenue_aux) AS revenue_aux,\n    SUM(t.revenue) AS revenue\nFROM (\n    SELECT \n        dr.date_day,\n        DATE(date_day, 'start of month') AS date_month,\n        ds.account_id,\n        COUNT(ds.deal_id) AS deals,\n        SUM(ds.revenue_core_day) AS revenue_core,\n        SUM(ds.revenue_aux_day) AS revenue_aux,\n        SUM(ds.revenue_day) AS revenue\n    FROM date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)\n    GROUP BY dr.date_day, ds.account_id) t\nGROUP BY account_id, date_month", "children": [{"type": "SELECT", "text": "SELECT", "children": []}, {"type": "select_list", "text": "t.date_month,\n    t.account_id,\n    AVG(t.deals) AS deals,\n    SUM(t.revenue_core) AS revenue_core,\n    SUM(t.revenue_aux) AS revenue_aux,\n    SUM(t.revenue) AS revenue", "children": [{"type": "select_expression", "text": "t.date_month", "children": [{"type": "identifier", "text": "t.date_month", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "t.account_id", "children": [{"type": "identifier", "text": "t.account_id", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "AVG(t.deals) AS deals", "children": [{"type": "function_call", "text": "AVG(t.deals)", "children": [{"type": "identifier", "text": "AVG", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "t.deals", "children": [{"type": "identifier", "text": "t.deals", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS deals", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "deals", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "SUM(t.revenue_core) AS revenue_core", "children": [{"type": "function_call", "text": "SUM(t.revenue_core)", "children": [{"type": "identifier", "text": "SUM", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "t.revenue_core", "children": [{"type": "identifier", "text": "t.revenue_core", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS revenue_core", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue_core", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "SUM(t.revenue_aux) AS revenue_aux", "children": [{"type": "function_call", "text": "SUM(t.revenue_aux)", "children": [{"type": "identifier", "text": "SUM", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "t.revenue_aux", "children": [{"type": "identifier", "text": "t.revenue_aux", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS revenue_aux", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue_aux", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "SUM(t.revenue) AS revenue", "children": [{"type": "function_call", "text": "SUM(t.revenue)", "children": [{"type": "identifier", "text": "SUM", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "t.revenue", "children": [{"type": "identifier", "text": "t.revenue", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS revenue", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue", "children": []}]}]}]}, {"type": "from_clause", "text": "FROM (\n    SELECT \n        dr.date_day,\n        DATE(date_day, 'start of month') AS date_month,\n        ds.account_id,\n        COUNT(ds.deal_id) AS deals,\n        SUM(ds.revenue_core_day) AS revenue_core,\n        SUM(ds.revenue_aux_day) AS revenue_aux,\n        SUM(ds.revenue_day) AS revenue\n    FROM date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)\n    GROUP BY dr.date_day, ds.account_id) t", "children": [{"type": "FROM", "text": "FROM", "children": []}, {"type": "from_item", "text": "(\n    SELECT \n        dr.date_day,\n        DATE(date_day, 'start of month') AS date_month,\n        ds.account_id,\n        COUNT(ds.deal_id) AS deals,\n        SUM(ds.revenue_core_day) AS revenue_core,\n        SUM(ds.revenue_aux_day) AS revenue_aux,\n        SUM(ds.revenue_day) AS revenue\n    FROM date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)\n    GROUP BY dr.date_day, ds.account_id) t", "children": [{"type": "select_subexpression", "text": "(\n    SELECT \n        dr.date_day,\n        DATE(date_day, 'start of month') AS date_month,\n        ds.account_id,\n        COUNT(ds.deal_id) AS deals,\n        SUM(ds.revenue_core_day) AS revenue_core,\n        SUM(ds.revenue_aux_day) AS revenue_aux,\n        SUM(ds.revenue_day) AS revenue\n    FROM date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)\n    GROUP BY dr.date_day, ds.account_id)", "children": [{"type": "(", "text": "(", "children": []}, {"type": "query_expr", "text": "SELECT \n        dr.date_day,\n        DATE(date_day, 'start of month') AS date_month,\n        ds.account_id,\n        COUNT(ds.deal_id) AS deals,\n        SUM(ds.revenue_core_day) AS revenue_core,\n        SUM(ds.revenue_aux_day) AS revenue_aux,\n        SUM(ds.revenue_day) AS revenue\n    FROM date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)\n    GROUP BY dr.date_day, ds.account_id", "children": [{"type": "select", "text": "SELECT \n        dr.date_day,\n        DATE(date_day, 'start of month') AS date_month,\n        ds.account_id,\n        COUNT(ds.deal_id) AS deals,\n        SUM(ds.revenue_core_day) AS revenue_core,\n        SUM(ds.revenue_aux_day) AS revenue_aux,\n        SUM(ds.revenue_day) AS revenue\n    FROM date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)\n    GROUP BY dr.date_day, ds.account_id", "children": [{"type": "SELECT", "text": "SELECT", "children": []}, {"type": "select_list", "text": "dr.date_day,\n        DATE(date_day, 'start of month') AS date_month,\n        ds.account_id,\n        COUNT(ds.deal_id) AS deals,\n        SUM(ds.revenue_core_day) AS revenue_core,\n        SUM(ds.revenue_aux_day) AS revenue_aux,\n        SUM(ds.revenue_day) AS revenue", "children": [{"type": "select_expression", "text": "dr.date_day", "children": [{"type": "identifier", "text": "dr.date_day", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "DATE(date_day, 'start of month') AS date_month", "children": [{"type": "function_call", "text": "DATE(date_day, 'start of month')", "children": [{"type": "identifier", "text": "DATE", "children": [{"type": "DATE", "text": "DATE", "children": []}]}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "date_day", "children": [{"type": "identifier", "text": "date_day", "children": []}]}, {"type": ",", "text": ",", "children": []}, {"type": "argument", "text": "'start of month'", "children": [{"type": "string", "text": "'start of month'", "children": []}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS date_month", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "date_month", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "ds.account_id", "children": [{"type": "identifier", "text": "ds.account_id", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "COUNT(ds.deal_id) AS deals", "children": [{"type": "function_call", "text": "COUNT(ds.deal_id)", "children": [{"type": "identifier", "text": "COUNT", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "ds.deal_id", "children": [{"type": "identifier", "text": "ds.deal_id", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS deals", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "deals", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "SUM(ds.revenue_core_day) AS revenue_core", "children": [{"type": "function_call", "text": "SUM(ds.revenue_core_day)", "children": [{"type": "identifier", "text": "SUM", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "ds.revenue_core_day", "children": [{"type": "identifier", "text": "ds.revenue_core_day", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS revenue_core", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue_core", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "SUM(ds.revenue_aux_day) AS revenue_aux", "children": [{"type": "function_call", "text": "SUM(ds.revenue_aux_day)", "children": [{"type": "identifier", "text": "SUM", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "ds.revenue_aux_day", "children": [{"type": "identifier", "text": "ds.revenue_aux_day", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS revenue_aux", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue_aux", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "SUM(ds.revenue_day) AS revenue", "children": [{"type": "function_call", "text": "SUM(ds.revenue_day)", "children": [{"type": "identifier", "text": "SUM", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "ds.revenue_day", "children": [{"type": "identifier", "text": "ds.revenue_day", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS revenue", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue", "children": []}]}]}]}, {"type": "from_clause", "text": "FROM date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)", "children": [{"type": "FROM", "text": "FROM", "children": []}, {"type": "from_item", "text": "date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)", "children": [{"type": "join_operation", "text": "date_ranges dr\n    LEFT JOIN deals_signed ds \n        ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)", "children": [{"type": "from_item", "text": "date_ranges dr", "children": [{"type": "identifier", "text": "date_ranges", "children": []}, {"type": "as_alias", "text": "dr", "children": [{"type": "identifier", "text": "dr", "children": []}]}]}, {"type": "join_type", "text": "LEFT", "children": [{"type": "LEFT", "text": "LEFT", "children": []}]}, {"type": "JOIN", "text": "JOIN", "children": []}, {"type": "from_item", "text": "deals_signed ds", "children": [{"type": "identifier", "text": "deals_signed", "children": []}, {"type": "as_alias", "text": "ds", "children": [{"type": "identifier", "text": "ds", "children": []}]}]}, {"type": "join_condition", "text": "ON  dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)", "children": [{"type": "ON", "text": "ON", "children": []}, {"type": "binary_expression", "text": "dr.date_day >= date(ds.contract_start_date)\n        AND dr.date_day <= date(ds.contract_end_date)", "children": [{"type": "binary_expression", "text": "dr.date_day >= date(ds.contract_start_date)", "children": [{"type": "identifier", "text": "dr.date_day", "children": [{"type": ".", "text": ".", "children": []}]}, {"type": ">=", "text": ">=", "children": []}, {"type": "function_call", "text": "date(ds.contract_start_date)", "children": [{"type": "identifier", "text": "date", "children": [{"type": "DATE", "text": "date", "children": []}]}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "ds.contract_start_date", "children": [{"type": "identifier", "text": "ds.contract_start_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}]}, {"type": "AND", "text": "AND", "children": []}, {"type": "binary_expression", "text": "dr.date_day <= date(ds.contract_end_date)", "children": [{"type": "identifier", "text": "dr.date_day", "children": [{"type": ".", "text": ".", "children": []}]}, {"type": "<=", "text": "<=", "children": []}, {"type": "function_call", "text": "date(ds.contract_end_date)", "children": [{"type": "identifier", "text": "date", "children": [{"type": "DATE", "text": "date", "children": []}]}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "ds.contract_end_date", "children": [{"type": "identifier", "text": "ds.contract_end_date", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ")", "text": ")", "children": []}]}]}]}]}]}]}]}, {"type": "group_by_clause", "text": "GROUP BY dr.date_day, ds.account_id", "children": [{"type": "GROUP_BY", "text": "GROUP", "children": []}, {"type": "GROUP_BY", "text": "BY", "children": []}, {"type": "grouping_item", "text": "dr.date_day", "children": [{"type": "identifier", "text": "dr.date_day", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "grouping_item", "text": "ds.account_id", "children": [{"type": "identifier", "text": "ds.account_id", "children": [{"type": ".", "text": ".", "children": []}]}]}]}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "t", "children": [{"type": "identifier", "text": "t", "children": []}]}]}]}, {"type": "group_by_clause", "text": "GROUP BY account_id, date_month", "children": [{"type": "GROUP_BY", "text": "GROUP", "children": []}, {"type": "GROUP_BY", "text": "BY", "children": []}, {"type": "grouping_item", "text": "account_id", "children": [{"type": "identifier", "text": "account_id", "children": []}]}, {"type": ",", "text": ",", "children": []}, {"type": "grouping_item", "text": "date_month", "children": [{"type": "identifier", "text": "date_month", "children": []}]}]}]}]}]}]}, {"type": ";", "text": ";", "children": []}]}}, {"root": {"type": "source_file", "text": "DROP TABLE IF EXISTS accounts_360;\nCREATE TABLE accounts_360 AS\nSELECT \n    t.*,\n    CASE \n        WHEN t.revenue_12m <= 300 THEN 'Small'\n        WHEN t.revenue_12m > 300 AND t.revenue_12m <= 600 THEN 'Medium'\n        WHEN t.revenue_12m > 600 THEN 'Large'\n        ELSE NULL\n    END AS account_size\nFROM (\n    SELECT \n        account_id,\n        date_month,\n        revenue,\n        revenue_core,\n        revenue_aux,\n        deals,\n        accounts.name,\n        accounts.industry,\n        accounts.country,\n        accounts.priority,\n        SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        ) AS revenue_12m\n    FROM accounts_revenue\n    JOIN accounts USING (account_id)\n) AS t;\n", "children": [{"type": "drop_table_statement", "text": "DROP TABLE IF EXISTS accounts_360", "children": [{"type": "DROP", "text": "DROP", "children": []}, {"type": "TABLE", "text": "TABLE", "children": []}, {"type": "keyword_if_exists", "text": "IF EXISTS", "children": [{"type": "IF_EXISTS", "text": "IF", "children": []}, {"type": "IF_EXISTS", "text": "EXISTS", "children": []}]}, {"type": "identifier", "text": "accounts_360", "children": []}]}, {"type": ";", "text": ";", "children": []}, {"type": "create_table_statement", "text": "CREATE TABLE accounts_360 AS\nSELECT \n    t.*,\n    CASE \n        WHEN t.revenue_12m <= 300 THEN 'Small'\n        WHEN t.revenue_12m > 300 AND t.revenue_12m <= 600 THEN 'Medium'\n        WHEN t.revenue_12m > 600 THEN 'Large'\n        ELSE NULL\n    END AS account_size\nFROM (\n    SELECT \n        account_id,\n        date_month,\n        revenue,\n        revenue_core,\n        revenue_aux,\n        deals,\n        accounts.name,\n        accounts.industry,\n        accounts.country,\n        accounts.priority,\n        SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        ) AS revenue_12m\n    FROM accounts_revenue\n    JOIN accounts USING (account_id)\n) AS t", "children": [{"type": "CREATE", "text": "CREATE", "children": []}, {"type": "TABLE", "text": "TABLE", "children": []}, {"type": "identifier", "text": "accounts_360", "children": []}, {"type": "AS", "text": "AS", "children": []}, {"type": "query_statement", "text": "SELECT \n    t.*,\n    CASE \n        WHEN t.revenue_12m <= 300 THEN 'Small'\n        WHEN t.revenue_12m > 300 AND t.revenue_12m <= 600 THEN 'Medium'\n        WHEN t.revenue_12m > 600 THEN 'Large'\n        ELSE NULL\n    END AS account_size\nFROM (\n    SELECT \n        account_id,\n        date_month,\n        revenue,\n        revenue_core,\n        revenue_aux,\n        deals,\n        accounts.name,\n        accounts.industry,\n        accounts.country,\n        accounts.priority,\n        SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        ) AS revenue_12m\n    FROM accounts_revenue\n    JOIN accounts USING (account_id)\n) AS t", "children": [{"type": "query_expr", "text": "SELECT \n    t.*,\n    CASE \n        WHEN t.revenue_12m <= 300 THEN 'Small'\n        WHEN t.revenue_12m > 300 AND t.revenue_12m <= 600 THEN 'Medium'\n        WHEN t.revenue_12m > 600 THEN 'Large'\n        ELSE NULL\n    END AS account_size\nFROM (\n    SELECT \n        account_id,\n        date_month,\n        revenue,\n        revenue_core,\n        revenue_aux,\n        deals,\n        accounts.name,\n        accounts.industry,\n        accounts.country,\n        accounts.priority,\n        SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        ) AS revenue_12m\n    FROM accounts_revenue\n    JOIN accounts USING (account_id)\n) AS t", "children": [{"type": "select", "text": "SELECT \n    t.*,\n    CASE \n        WHEN t.revenue_12m <= 300 THEN 'Small'\n        WHEN t.revenue_12m > 300 AND t.revenue_12m <= 600 THEN 'Medium'\n        WHEN t.revenue_12m > 600 THEN 'Large'\n        ELSE NULL\n    END AS account_size\nFROM (\n    SELECT \n        account_id,\n        date_month,\n        revenue,\n        revenue_core,\n        revenue_aux,\n        deals,\n        accounts.name,\n        accounts.industry,\n        accounts.country,\n        accounts.priority,\n        SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        ) AS revenue_12m\n    FROM accounts_revenue\n    JOIN accounts USING (account_id)\n) AS t", "children": [{"type": "SELECT", "text": "SELECT", "children": []}, {"type": "select_list", "text": "t.*,\n    CASE \n        WHEN t.revenue_12m <= 300 THEN 'Small'\n        WHEN t.revenue_12m > 300 AND t.revenue_12m <= 600 THEN 'Medium'\n        WHEN t.revenue_12m > 600 THEN 'Large'\n        ELSE NULL\n    END AS account_size", "children": [{"type": "select_all", "text": "t.*", "children": [{"type": "asterisk_expression", "text": "t.*", "children": [{"type": ".", "text": ".", "children": []}, {"type": "*", "text": "*", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "CASE \n        WHEN t.revenue_12m <= 300 THEN 'Small'\n        WHEN t.revenue_12m > 300 AND t.revenue_12m <= 600 THEN 'Medium'\n        WHEN t.revenue_12m > 600 THEN 'Large'\n        ELSE NULL\n    END AS account_size", "children": [{"type": "casewhen_expression", "text": "CASE \n        WHEN t.revenue_12m <= 300 THEN 'Small'\n        WHEN t.revenue_12m > 300 AND t.revenue_12m <= 600 THEN 'Medium'\n        WHEN t.revenue_12m > 600 THEN 'Large'\n        ELSE NULL\n    END", "children": [{"type": "CASE", "text": "CASE", "children": []}, {"type": "casewhen_clause", "text": "WHEN t.revenue_12m <= 300 THEN 'Small'", "children": [{"type": "WHEN", "text": "WHEN", "children": []}, {"type": "binary_expression", "text": "t.revenue_12m <= 300", "children": [{"type": "identifier", "text": "t.revenue_12m", "children": [{"type": ".", "text": ".", "children": []}]}, {"type": "<=", "text": "<=", "children": []}, {"type": "number", "text": "300", "children": []}]}, {"type": "THEN", "text": "THEN", "children": []}, {"type": "string", "text": "'Small'", "children": []}]}, {"type": "casewhen_clause", "text": "WHEN t.revenue_12m > 300 AND t.revenue_12m <= 600 THEN 'Medium'", "children": [{"type": "WHEN", "text": "WHEN", "children": []}, {"type": "binary_expression", "text": "t.revenue_12m > 300 AND t.revenue_12m <= 600", "children": [{"type": "binary_expression", "text": "t.revenue_12m > 300", "children": [{"type": "identifier", "text": "t.revenue_12m", "children": [{"type": ".", "text": ".", "children": []}]}, {"type": ">", "text": ">", "children": []}, {"type": "number", "text": "300", "children": []}]}, {"type": "AND", "text": "AND", "children": []}, {"type": "binary_expression", "text": "t.revenue_12m <= 600", "children": [{"type": "identifier", "text": "t.revenue_12m", "children": [{"type": ".", "text": ".", "children": []}]}, {"type": "<=", "text": "<=", "children": []}, {"type": "number", "text": "600", "children": []}]}]}, {"type": "THEN", "text": "THEN", "children": []}, {"type": "string", "text": "'Medium'", "children": []}]}, {"type": "casewhen_clause", "text": "WHEN t.revenue_12m > 600 THEN 'Large'", "children": [{"type": "WHEN", "text": "WHEN", "children": []}, {"type": "binary_expression", "text": "t.revenue_12m > 600", "children": [{"type": "identifier", "text": "t.revenue_12m", "children": [{"type": ".", "text": ".", "children": []}]}, {"type": ">", "text": ">", "children": []}, {"type": "number", "text": "600", "children": []}]}, {"type": "THEN", "text": "THEN", "children": []}, {"type": "string", "text": "'Large'", "children": []}]}, {"type": "caseelse_clause", "text": "ELSE NULL", "children": [{"type": "ELSE", "text": "ELSE", "children": []}, {"type": "NULL", "text": "NULL", "children": [{"type": "NULL", "text": "NULL", "children": []}]}]}, {"type": "END", "text": "END", "children": []}]}, {"type": "as_alias", "text": "AS account_size", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "account_size", "children": []}]}]}]}, {"type": "from_clause", "text": "FROM (\n    SELECT \n        account_id,\n        date_month,\n        revenue,\n        revenue_core,\n        revenue_aux,\n        deals,\n        accounts.name,\n        accounts.industry,\n        accounts.country,\n        accounts.priority,\n        SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        ) AS revenue_12m\n    FROM accounts_revenue\n    JOIN accounts USING (account_id)\n) AS t", "children": [{"type": "FROM", "text": "FROM", "children": []}, {"type": "from_item", "text": "(\n    SELECT \n        account_id,\n        date_month,\n        revenue,\n        revenue_core,\n        revenue_aux,\n        deals,\n        accounts.name,\n        accounts.industry,\n        accounts.country,\n        accounts.priority,\n        SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        ) AS revenue_12m\n    FROM accounts_revenue\n    JOIN accounts USING (account_id)\n) AS t", "children": [{"type": "select_subexpression", "text": "(\n    SELECT \n        account_id,\n        date_month,\n        revenue,\n        revenue_core,\n        revenue_aux,\n        deals,\n        accounts.name,\n        accounts.industry,\n        accounts.country,\n        accounts.priority,\n        SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        ) AS revenue_12m\n    FROM accounts_revenue\n    JOIN accounts USING (account_id)\n)", "children": [{"type": "(", "text": "(", "children": []}, {"type": "query_expr", "text": "SELECT \n        account_id,\n        date_month,\n        revenue,\n        revenue_core,\n        revenue_aux,\n        deals,\n        accounts.name,\n        accounts.industry,\n        accounts.country,\n        accounts.priority,\n        SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        ) AS revenue_12m\n    FROM accounts_revenue\n    JOIN accounts USING (account_id)", "children": [{"type": "select", "text": "SELECT \n        account_id,\n        date_month,\n        revenue,\n        revenue_core,\n        revenue_aux,\n        deals,\n        accounts.name,\n        accounts.industry,\n        accounts.country,\n        accounts.priority,\n        SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        ) AS revenue_12m\n    FROM accounts_revenue\n    JOIN accounts USING (account_id)", "children": [{"type": "SELECT", "text": "SELECT", "children": []}, {"type": "select_list", "text": "account_id,\n        date_month,\n        revenue,\n        revenue_core,\n        revenue_aux,\n        deals,\n        accounts.name,\n        accounts.industry,\n        accounts.country,\n        accounts.priority,\n        SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        ) AS revenue_12m", "children": [{"type": "select_expression", "text": "account_id", "children": [{"type": "identifier", "text": "account_id", "children": []}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "date_month", "children": [{"type": "identifier", "text": "date_month", "children": []}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "revenue", "children": [{"type": "identifier", "text": "revenue", "children": []}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "revenue_core", "children": [{"type": "identifier", "text": "revenue_core", "children": []}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "revenue_aux", "children": [{"type": "identifier", "text": "revenue_aux", "children": []}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "deals", "children": [{"type": "identifier", "text": "deals", "children": []}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "accounts.name", "children": [{"type": "identifier", "text": "accounts.name", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "accounts.industry", "children": [{"type": "identifier", "text": "accounts.industry", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "accounts.country", "children": [{"type": "identifier", "text": "accounts.country", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "accounts.priority", "children": [{"type": "identifier", "text": "accounts.priority", "children": [{"type": ".", "text": ".", "children": []}]}]}, {"type": ",", "text": ",", "children": []}, {"type": "select_expression", "text": "SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        ) AS revenue_12m", "children": [{"type": "function_call", "text": "SUM(revenue) OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        )", "children": [{"type": "identifier", "text": "SUM", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "argument", "text": "revenue", "children": [{"type": "identifier", "text": "revenue", "children": []}]}, {"type": ")", "text": ")", "children": []}, {"type": "analytics_clause", "text": "OVER (\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        )", "children": [{"type": "OVER", "text": "OVER", "children": []}, {"type": "over_clause", "text": "(\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        )", "children": [{"type": "window_specification", "text": "(\n            PARTITION BY account_id \n            ORDER BY date_month \n            ROWS BETWEEN 11 PRECEDING AND CURRENT ROW\n        )", "children": [{"type": "(", "text": "(", "children": []}, {"type": "window_partition_clause", "text": "PARTITION BY account_id", "children": [{"type": "PARTITION_BY", "text": "PARTITION", "children": []}, {"type": "PARTITION_BY", "text": "BY", "children": []}, {"type": "partition_expression", "text": "account_id", "children": [{"type": "identifier", "text": "account_id", "children": []}]}]}, {"type": "order_by_clause", "text": "ORDER BY date_month", "children": [{"type": "ORDER_BY", "text": "ORDER", "children": []}, {"type": "ORDER_BY", "text": "BY", "children": []}, {"type": "order_by_clause_body", "text": "date_month", "children": [{"type": "identifier", "text": "date_month", "children": []}]}]}, {"type": "window_frame_clause", "text": "ROWS BETWEEN 11 PRECEDING AND CURRENT ROW", "children": [{"type": "rows_range", "text": "ROWS", "children": [{"type": "ROWS", "text": "ROWS", "children": []}]}, {"type": "window_frame_between", "text": "BETWEEN 11 PRECEDING AND CURRENT ROW", "children": [{"type": "BETWEEN", "text": "BETWEEN", "children": []}, {"type": "between_from", "text": "11 PRECEDING", "children": [{"type": "number", "text": "11", "children": []}, {"type": "PRECEDING", "text": "PRECEDING", "children": []}]}, {"type": "AND", "text": "AND", "children": []}, {"type": "between_to", "text": "CURRENT ROW", "children": [{"type": "keyword_current_row", "text": "CURRENT ROW", "children": [{"type": "CURRENT_ROW", "text": "CURRENT", "children": []}, {"type": "CURRENT_ROW", "text": "ROW", "children": []}]}]}]}]}, {"type": ")", "text": ")", "children": []}]}]}]}]}, {"type": "as_alias", "text": "AS revenue_12m", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "revenue_12m", "children": []}]}]}]}, {"type": "from_clause", "text": "FROM accounts_revenue\n    JOIN accounts USING (account_id)", "children": [{"type": "FROM", "text": "FROM", "children": []}, {"type": "from_item", "text": "accounts_revenue\n    JOIN accounts USING (account_id)", "children": [{"type": "join_operation", "text": "accounts_revenue\n    JOIN accounts USING (account_id)", "children": [{"type": "from_item", "text": "accounts_revenue", "children": [{"type": "identifier", "text": "accounts_revenue", "children": []}]}, {"type": "JOIN", "text": "JOIN", "children": []}, {"type": "from_item", "text": "accounts", "children": [{"type": "identifier", "text": "accounts", "children": []}]}, {"type": "join_condition", "text": "USING (account_id)", "children": [{"type": "USING", "text": "USING", "children": []}, {"type": "(", "text": "(", "children": []}, {"type": "identifier", "text": "account_id", "children": []}, {"type": ")", "text": ")", "children": []}]}]}]}]}]}]}, {"type": ")", "text": ")", "children": []}]}, {"type": "as_alias", "text": "AS t", "children": [{"type": "AS", "text": "AS", "children": []}, {"type": "identifier", "text": "t", "children": []}]}]}]}]}]}]}]}, {"type": ";", "text": ";", "children": []}]}}]